function ajax(params){params=params||{};if(!params.url){throw new Error('Necessary parameters are missing.');}var options={url:params.url||'',type:(params.type||'GET').toUpperCase(),timeout:params.timeout||5000,async:true,complete:params.complete||function(){},error:params.error||function(){},success:params.success||function(){},dataType:params.dataType||'json',data:params.data||{},jsonp:params.jsonp||'callback',jsonpCallback:params.jsonpCallback||('jsonp_'+Math.random()).replace('.','')};var formatParams=function(json){var arr=[];for(var i in json){arr.push(encodeURIComponent(i)+'='+encodeURIComponent(json[i]))}return arr.join("&")};if(typeof options.data=='object'){options.data=formatParams(options.data)}if(options.dataType=='jsonp'){var $head=document.getElementsByTagName('head')[0];var $script=document.createElement('script');$head.appendChild($script);window[options.jsonpCallback]=function(json){$head.removeChild($script);window[options.jsonpCallback]=null;hander&&clearTimeout(hander);options.success(json);options.complete()};if(options.data){options.data+='&'+options.jsonp+'='+options.jsonpCallback}else{options.data+=options.jsonp+'='+options.jsonpCallback}$script.src=options.url+'?'+options.data;var hander=setTimeout(function(){$head.removeChild($script);window[options.jsonpCallback]=null;options.error();options.complete()},options.timeout)}else{var xhr=new(self.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP");if(!xhr){return false}if(options.type=='POST'){xhr.open(options.type,options.url,options.async);xhr.setRequestHeader('content-type','application/x-www-form-urlencoded');xhr.send(options.data)}else{xhr.open(options.type,options.url+'?'+options.data,options.async);xhr.send(null)}var requestDone=false;var hander=setTimeout(function(){requestDone=true;if(xhr.readyState!=4){xhr.abort();options.error()}options.complete()},options.timeout);xhr.onreadystatechange=function(){if(xhr.readyState==4&&!requestDone){if(xhr.status>=200&&xhr.status<300){var data=options.dataType=="xml"?xhr.responseXML:xhr.responseText;if(options.dataType=="json"){try{data=JSON.parse(data)}catch(e){data=eval('('+data+')')}}options.success(data)}else{options.error()}hander&&clearTimeout(hander);options.complete()}}}}var addCookie=function(objName,objValue,objMinute,objDomain,objPath){var str=objName+"="+encodeURIComponent(objValue);if(objMinute>0){var date=new Date();var ms=objMinute*60*1000;date.setTime(date.getTime()+ms);str+="; expires="+date.toGMTString();if(objDomain){str+=";domain="+objDomain}if(objPath){str+=";path="+objPath}}document.cookie=str};var getCookie=function(objName){var arrStr=document.cookie.split("; ");for(var i=0;i<arrStr.length;i++){var temp=arrStr[i].split("=");if(temp[0]==objName)return decodeURIComponent(temp[1])}};(function(){var $mod_panel=DOMUtil.getElementsByClassName('mod-panel')[0];var $search=DOMUtil.getElementsByClassName('search',$mod_panel)[0];var $button=DOMUtil.getElementsByClassName('input-button',$mod_panel);var $text=DOMUtil.getElementsByClassName('input-text',$mod_panel)[0];var $clear=document.createElement('a');var size=window.innerWidth<1024?60:100;$clear.setAttribute('href','javascript:;');$clear.style.display='none';$clear.style.right=$button.length*size+5+'px';$clear.className='clear';$clear.innerHTML='<span>X</span>';$search.appendChild($clear);var clearText=function(){var value=$text.value;if(value){$clear.style.display='block'}else{$clear.style.display='none'}};var testinput=document.createElement('input');if('oninput'in testinput){$text.addEventListener("input",clearText,false)}else{$text.onpropertychange=clearText}$clear.onclick=function(){$text.value='';$clear.style.display='none'};clearText()})();(function(){var $mod_panel=DOMUtil.getElementsByClassName('mod-panel')[0];var $button=DOMUtil.getElementsByClassName('input-button',$mod_panel)[0];var $text=DOMUtil.getElementsByClassName('input-text',$mod_panel)[0];var $visit=DOMUtil.getElementsByClassName('input-visit',$mod_panel)[0];var reg={ip:/^((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)(\.((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)){3}$/,domain:/^([a-zA-Z0-9][-a-zA-Z0-9]{0,62}\.)+([a-zA-Z]{1,63})\.?$/};var check=function(){var value=$text.value.trim();if(value==''){alert('请输入您要查询的域名或者ip！');return false}else if(!(value.match(reg['domain'])||value.match(reg['ip']))){alert('域名或者ip格式错误！');return false}else{location.href='/'+value+'/'}return true};$text.onkeydown=function(e){var e=e||window.event;if(e&&e.keyCode==13){check()}};$button.onclick=check;if($visit){$visit.onclick=function(e){var value=$text.value.trim();if(value==''){alert('请输入您要查询的域名或者ip！');return false}else if(!(value.match(reg['domain'])||value.match(reg['ip']))){alert('域名或者ip格式错误！');return false}else{window.open('http://'+value)}return true}}var findDomain=function(){var value=$text.value.trim().replace(/[\r\n]/g,"");var temp=value;var match=value.match(/((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)(\.((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)){3}/);if(match){value=match[0]}match=value.match(/([a-zA-Z0-9][-a-zA-Z0-9]{0,62}\.)+([a-zA-Z0-9\-]{1,63})\.?/);if(match){value=match[0]}value=value.replace(/[^a-zA-Z0-9\-\.]/g,"");if(value!=temp){$text.value=value}};var testinput=document.createElement('input');if('onpaste'in testinput&&navigator.userAgent.indexOf('Mac OS')>-1){$text.addEventListener("paste",function(){setTimeout(function(){findDomain()},0)},false)}else if('oninput'in testinput){$text.addEventListener("input",findDomain,false)}else{$text.onpropertychange=findDomain}if(location.hash){var value=location.hash.substr(1);var match=value.match(/((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)(\.((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)){3}/);if(match){value=match[0]}match=value.match(/([a-zA-Z0-9][-a-zA-Z0-9]{0,62}\.)+([a-zA-Z]{1,63})\.?/);if(match){value=match[0]}if(value.match(reg['domain'])||value.match(reg['ip'])){location.href='/'+value+'/'}}})();(function(){var value=document.getElementById('input').value.trim();var $adress=document.getElementById('curadress');var hash={};if(typeof JSON!='undefined'&&JSON.parse){var addr=getCookie('addr');if(addr){hash=JSON.parse(addr)}}if($adress){var parant=/^([a-zA-Z0-9][-a-zA-Z0-9]{0,62}\.)+([a-zA-Z]{1,63})\.?$/;if(parant.test(value)){var count=0;var q=function(){count++;ajax({url:'/domain/read.do',data:{domain:value,time:(+new Date())},dataType:'json',timeout:3000,method:'GET',success:function(json){if(!json.status){if(count>2){hander&&clearInterval(hander);$adress.innerHTML=json.msg||'未查找到结果！'}}else{hander&&clearInterval(hander);$adress.innerHTML='';for(var i=0;i<json.data.length;i++){(function(i){var item=json.data[i];var $p=document.createElement('P');var $a=document.createElement('A');var $span=document.createElement('SPAN');$a.setAttribute('href','/'+item['ip']+'/');$a.setAttribute('target','_blank');$a.innerHTML=item['ip'];$span.innerHTML='<img src="//cache.ip138.com/site/image/public/loading.gif" width="20" height="20" style="margin-right:20px;">';$span.className='addr';$p.appendChild($span);$p.appendChild($a);if(!hash[item['ip']]){ajax({url:'//api.ip138.com/query/',method:'GET',dataType:'jsonp',data:'ip='+item['ip']+'&oid=5&mid=5&datatype=jsonp&sign='+item['sign'],success:function(json){if(json['ret']=='ok'){if(json['data'].length>4){json['data'].length=4}hash[item['ip']]=json['data'].join(' ');$span.innerHTML=hash[item['ip']];if(typeof JSON!='undefined'&&JSON.stringify){var addr=JSON.stringify(hash);if(addr){addCookie('addr',addr,1)}}}else{$span.innerHTML=''}},error:function(){$span.innerHTML=''}})}else{$span.innerHTML=hash[item['ip']]}$adress.appendChild($p)})(i)}}},error:function(){if(count>2){hander&&clearInterval(hander);$adress.innerHTML='未查找到结果！'}}})};var hander=setInterval(q,3000);q()}}})();(function(){var value=document.getElementById('input').value.trim();var $list=document.getElementById('list');if($list){var ip=/^((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)(\.((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)){3}$/;var isAjax=false;var hasData=$list.getElementsByTagName('li').length>20;var page=1;if(ip.test(value)){window.onscroll=function(){var rect=$list.getBoundingClientRect();var bottom=rect.top+$list.offsetHeight;var window_height=window.innerHeight||document.documentElement.clientHeight;if(!isAjax&&hasData&&bottom<window_height){isAjax=true;page++;var $loading=document.createElement('li');$loading.innerHTML='<img src="//cache.ip138.com/site/image/public/loading.gif" width="32" height="32">';$list.appendChild($loading);ajax({url:'/index/querybyip/',data:{ip:value,page:page,token:(_TOKEN||'')},success:function(json){if(json.status&&json.data){if(json.data.length<20){hasData=false}for(var i=0;i<json.data.length;i++){var item=json.data[i];var addtime=item['addtime'].replace(/(\d{4})(\d{2})(\d{2})/,'$1-$2-$3');var uptime=item['uptime'].replace(/(\d{4})(\d{2})(\d{2})/,'$1-$2-$3');var $li=document.createElement('li');$li.innerHTML='<span class="date">'+addtime+'-----'+uptime+'</span><a href="/'+item.domain+'/" target="_blank">'+item.domain+'</a>';$list.appendChild($li)}}else{hasData=false}},complete:function(){isAjax=false;if($loading){$list.removeChild($loading);$loading=null}}})}}}}})();